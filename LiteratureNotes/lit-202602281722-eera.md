---
title: "Webhooks and Events"
date: "2026-02-28"
tags:
  - livekit
  - voice-agents
  - ai
  - webrtc
draft: false
extra:
  chapter: "Phase 1 - æ¦‚å¿µãƒ¢ãƒ‡ãƒ«ï¼ˆè£œè¶³ï¼‰"
---

# Webhooks and Events

å‚ç…§å…ƒ: [[SourceNotes/LiveKit Agents Documentation.md|LiveKit Agents Documentation]]
ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—: [[StructureNotes/LiveKit_Agent_Framework_å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—.md|å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—]]

## ä¸€è¨€ã¾ã¨ã‚

**SDK Events** = çŠ¶æ…‹å¤‰åŒ–ã®é€šçŸ¥ï¼ˆä½•ã‹ãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’çŸ¥ã‚‹ï¼‰
**Track Stream** = ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æƒ…å ±ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æç”»ãƒ»å¯¾å¿œï¼ˆå®Ÿéš›ã®ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ï¼‰
**Webhook** = ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰é€šçŸ¥

## Webhook vs SDK Events

| | Webhook | SDK Events |
|---|---|---|
| å‘ã | LiveKit â†’ **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ï¼ˆHTTP POSTï¼‰ | LiveKit SDK â†’ **ã‚¢ãƒ—ãƒªãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†…** |
| ç”¨é€” | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ãƒ­ã‚°ãƒ»å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  UI æ›´æ–°ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åå¿œ |
| å…·ä½“ä¾‹ | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚’DBã«è¨˜éŒ²ã€èª²é‡‘ãƒˆãƒªã‚¬ãƒ¼ | ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æŒ¨æ‹¶ |

```mermaid
graph LR
    LK["LiveKit Server"]

    LK -->|"HTTP POST\nï¼ˆWebhookï¼‰"| B["ğŸ–¥ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰"]
    LK -->|"SDK Events\nï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰"| A["ğŸ“± ã‚¢ãƒ—ãƒª / ğŸ¤– ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"]

    B --- B_ex["â€¢ DB ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²\nâ€¢ èª²é‡‘ãƒˆãƒªã‚¬ãƒ¼\nâ€¢ å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº"]
    A --- A_ex["â€¢ UI æ›´æ–°ï¼ˆãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ç­‰ï¼‰\nâ€¢ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æŒ¨æ‹¶ãƒ»åå¿œ\nâ€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­”"]
```

**ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã§ã¯ SDK Events ã‚’å¤§é‡ã«ä½¿ã†ã€‚**

## SDK Events + Track Stream ã®ä½¿ã„åˆ†ã‘

LiveKit ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªè¡¨ç¤ºã¯ã“ã®2å±¤ã§å‹•ãï¼š

```mermaid
graph TB
    SE["ğŸ”” SDK Event\nï¼ˆçŠ¶æ…‹å¤‰åŒ–ã‚’çŸ¥ã‚‹ï¼‰"]
    TS["ğŸ“¡ Track Stream\nï¼ˆãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ï¼‰"]

    SE -->|"ã€Œèª°ã‹ãŒå–‹ã‚Šå§‹ã‚ãŸã€\nã€Œã‚«ãƒ¡ãƒ©ãŒ ON ã«ãªã£ãŸã€"| UI["ğŸ–¥ï¸ UI æ›´æ–° / ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¿œç­”"]
    TS -->|"éŸ³å£°ãƒ»æ˜ åƒãƒ»ãƒ‡ãƒ¼ã‚¿\nã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ "| UI

    SE_ex["ä¾‹: ActiveSpeakersChanged\nTrackPublished / TrackUnpublished"] -.-> SE
    TS_ex["ä¾‹: audio level ãƒ‡ãƒ¼ã‚¿\nvideo frame"] -.-> TS
```

**å…·ä½“ä¾‹ï¼šéŸ³æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
- SDK Event `ActiveSpeakersChanged` ã§ã€ŒAã•ã‚“ãŒå–‹ã£ã¦ã„ã‚‹ã€ã‚’æ¤œçŸ¥
- Audio Track ã® audio level ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§èª­ã‚“ã§æ³¢å½¢ã‚’æç”»

**å…·ä½“ä¾‹ï¼šé¡”æ˜ åƒã®è¡¨ç¤º**
- SDK Event `TrackPublished` ã§ã€ŒBã•ã‚“ã®ã‚«ãƒ¡ãƒ©ãŒ ON ã«ãªã£ãŸã€ã‚’æ¤œçŸ¥
- Video Track ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãã®ã¾ã¾ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

## æ¥ç¶šã®2ãƒ•ã‚§ãƒ¼ã‚º

Participant ãŒ Room ã« join ã™ã‚‹ã¨ãã€æ¥ç¶šã¯2æ®µéšï¼š

1. **Signal connection** â€” ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ãƒãƒ£ãƒãƒ«ç¢ºç«‹ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»åˆ¶å¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
2. **Media connection** â€” å®Ÿéš›ã®ãƒ¡ãƒ‡ã‚£ã‚¢è»¢é€ãƒãƒ£ãƒãƒ«ç¢ºç«‹

```mermaid
sequenceDiagram
    participant C as Client / Agent
    participant L as LiveKit Server
    participant B as Backend

    C->>L: join()
    L-->>C: âœ… Signal connection ç¢ºç«‹
    Note over C,L: Phase 1: ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ï¼ˆåˆ¶å¾¡ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰
    L-->>C: âœ… Media connection ç¢ºç«‹
    Note over C,L: Phase 2: ãƒ¡ãƒ‡ã‚£ã‚¢è»¢é€ï¼ˆstate = activeï¼‰
    L->>B: participant_joined Webhook ğŸ””

    Note over C,L: âš ï¸ Media ãŒå¤±æ•—ã—ãŸå ´åˆ
    L--xC: Media connection å¤±æ•—
    L->>B: participant_connection_aborted Webhook âŒ
```

Signal ã ã‘ç¹‹ãŒã£ã¦ã‚‚ Media ãŒå¤±æ•—ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ï¼ˆ`participant_connection_aborted`ï¼‰ã€‚
`participant_joined` Webhook ã¯ **Media connection ç¢ºç«‹å¾Œï¼ˆstate = activeï¼‰**ã«ç™ºç«ã™ã‚‹ã€‚

## Webhook Events ä¸€è¦§

| ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---|---|
| `room_started` | æœ€åˆã® Participant ãŒ join ã—ã¦ Room ãŒå§‹ã¾ã£ãŸã¨ã |
| `room_finished` | æœ€å¾Œã®é€€å‡º â†’ empty timeout çµŒé â†’ Room ã‚¯ãƒ­ãƒ¼ã‚º |
| `participant_joined` | Media connection ç¢ºç«‹å¾Œï¼ˆstate = activeï¼‰ |
| `participant_left` | é€€å‡º & å…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†å¾Œ |
| `participant_connection_aborted` | Signal ã¯ç¹‹ãŒã£ãŸãŒ Media ãŒå¤±æ•—ã—ãŸã¨ã |
| `track_published` | Track ãŒ publish ã•ã‚ŒãŸã¨ãï¼ˆpayload ã® room/participant ã¯ SIDãƒ»nameãƒ»identity ã®ã¿ï¼‰ |
| `track_unpublished` | Track ãŒ unpublish ã•ã‚ŒãŸã¨ã |
| `egress_started` | éŒ²ç”»ãƒ»é…ä¿¡ï¼ˆEgressï¼‰é–‹å§‹ |
| `egress_updated` | Egress çŠ¶æ…‹æ›´æ–°ï¼ˆä¾‹: éŒ²ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå¤‰åŒ–ï¼‰ |
| `egress_ended` | Egress çµ‚äº† |
| `ingress_started` | å¤–éƒ¨ãƒ¡ãƒ‡ã‚£ã‚¢å–ã‚Šè¾¼ã¿ï¼ˆIngressï¼‰é–‹å§‹ |
| `ingress_ended` | Ingress çµ‚äº† |

## SDK Events ã®ç¨®é¡

Room events ã¨ Participant events ã®2ç¨®é¡ã€‚
**Room events ã¯ Participant events ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚»ãƒƒãƒˆ**ï¼ˆRoom å…¨ä½“ï¼‹å€‹åˆ¥ Participant ä¸¡æ–¹å—ã‘å–ã‚Œã‚‹ï¼‰ã€‚

â†’ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€Œã“ã® Participant ã ã‘ç›£è¦–ã€ã™ã‚‹ç²’åº¦ã§è¨­è¨ˆã§ãã‚‹ã€‚

## Webhook ã®ä¿¡é ¼æ€§

- HTTP POST ã§é…ä¿¡ã€‚**é…ä¿¡ä¿è¨¼ã¯ãªã„**ï¼ˆbest-effortï¼‰
- å¤±æ•—æ™‚ã¯ãƒªãƒˆãƒ©ã‚¤ã‚ã‚Šã€‚è¤‡æ•°ã‚¤ãƒ™ãƒ³ãƒˆãŒæºœã¾ã£ãŸå ´åˆã¯é †åºã‚’ä¿ã£ã¦ã‹ã‚‰å±Šã‘ã‚‹
- Authorization ãƒ˜ãƒƒãƒ€ãƒ¼ã«ç½²åæ¸ˆã¿ JWT ãŒå«ã¾ã‚Œã‚‹ï¼ˆæ­£è¦ LiveKit ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹æ¤œè¨¼å¯èƒ½ï¼‰
